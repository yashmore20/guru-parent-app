<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Guru.ai - Parent Portal</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- ============================================================ -->
<!-- WELCOME SCREEN -->
<!-- ============================================================ -->
<div id="welcome-screen" class="screen active">
    <div class="welcome-container">
        <div class="welcome-logo">
            <div class="logo-circle">
                <span class="logo-letter">G</span>
            </div>
            <h1 class="welcome-title">Guru.ai</h1>
            <p class="welcome-tagline">Your Child's AI Study Companion</p>
        </div>
        <div class="welcome-illustration">
            <div class="guru-character">
                <div class="guru-body"></div>
                <div class="guru-glow"></div>
            </div>
        </div>
        <div class="welcome-buttons">
            <button class="btn btn-primary btn-lg" onclick="showScreen('signup-screen')">Create Account</button>
            <button class="btn btn-outline btn-lg" onclick="showScreen('login-screen')">Login</button>
        </div>
    </div>
</div>

<!-- ============================================================ -->
<!-- LOGIN SCREEN -->
<!-- ============================================================ -->
<div id="login-screen" class="screen">
    <div class="auth-container">
        <button class="back-btn" onclick="showScreen('welcome-screen')">&#8592;</button>
        <div class="auth-header">
            <div class="logo-small">G</div>
            <h1>Welcome Back!</h1>
            <p>Login to monitor your child's progress</p>
        </div>
        <form id="login-form" class="auth-form">
            <div class="input-group">
                <label>Email</label>
                <div class="input-icon-wrap">
                    <span class="input-icon">&#9993;</span>
                    <input type="email" id="login-email" placeholder="parent@email.com" required>
                </div>
            </div>
            <div class="input-group">
                <label>Password</label>
                <div class="input-icon-wrap">
                    <span class="input-icon">&#128274;</span>
                    <input type="password" id="login-password" placeholder="Enter password" required>
                    <button type="button" class="toggle-pw" onclick="togglePassword('login-password', this)">&#128065;</button>
                </div>
            </div>
            <div class="form-options">
                <label class="checkbox-wrap">
                    <input type="checkbox" id="remember-me"> Remember me
                </label>
            </div>
            <button type="submit" class="btn btn-primary btn-lg btn-full">
                <span class="btn-text">Login</span>
                <span class="btn-loader" style="display:none;"></span>
            </button>
            <div id="login-error" class="msg-error" style="display:none;"></div>
        </form>
        <div class="auth-footer">
            <p>New parent? <a href="#" onclick="showScreen('signup-screen')">Create Account</a></p>
        </div>
    </div>
</div>

<!-- ============================================================ -->
<!-- SIGNUP SCREEN -->
<!-- ============================================================ -->
<div id="signup-screen" class="screen">
    <div class="auth-container">
        <button class="back-btn" onclick="showScreen('welcome-screen')">&#8592;</button>
        <div class="auth-header">
            <div class="logo-small">G</div>
            <h1>Create Account</h1>
            <p>Join thousands of parents helping their children learn better</p>
        </div>
        <form id="signup-form" class="auth-form">
            <div class="input-group">
                <label>Full Name</label>
                <div class="input-icon-wrap">
                    <span class="input-icon">&#128100;</span>
                    <input type="text" id="signup-name" placeholder="Your full name" required>
                </div>
            </div>
            <div class="input-group">
                <label>Email</label>
                <div class="input-icon-wrap">
                    <span class="input-icon">&#9993;</span>
                    <input type="email" id="signup-email" placeholder="parent@email.com" required>
                </div>
            </div>
            <div class="input-group">
                <label>Phone (optional)</label>
                <div class="input-icon-wrap">
                    <span class="input-icon">&#128222;</span>
                    <input type="tel" id="signup-phone" placeholder="+91 98765 43210">
                </div>
            </div>
            <div class="input-group">
                <label>Password (min 6 characters)</label>
                <div class="input-icon-wrap">
                    <span class="input-icon">&#128274;</span>
                    <input type="password" id="signup-password" placeholder="Create password" minlength="6" required>
                    <button type="button" class="toggle-pw" onclick="togglePassword('signup-password', this)">&#128065;</button>
                </div>
                <div id="pw-strength" class="pw-strength-bar"><div class="pw-fill"></div></div>
            </div>
            <button type="submit" class="btn btn-primary btn-lg btn-full">
                <span class="btn-text">Create Account</span>
                <span class="btn-loader" style="display:none;"></span>
            </button>
            <div id="signup-error" class="msg-error" style="display:none;"></div>
        </form>
        <div class="auth-footer">
            <p>Already have an account? <a href="#" onclick="showScreen('login-screen')">Login</a></p>
        </div>
    </div>
</div>

<!-- ============================================================ -->
<!-- SETUP: STEP 1 - PAIR DEVICE -->
<!-- ============================================================ -->
<div id="setup-device-screen" class="screen">
    <div class="setup-container">
        <div class="progress-steps">
            <div class="step active">1</div>
            <div class="step-line"></div>
            <div class="step">2</div>
            <div class="step-line"></div>
            <div class="step">3</div>
            <div class="step-line"></div>
            <div class="step">4</div>
        </div>
        <h1>Connect Your Guru Device</h1>
        <p class="setup-sub">Enter the 6-digit code shown on your Guru device screen</p>
        <div class="device-code-input">
            <input type="text" id="setup-device-code" maxlength="6" pattern="[0-9]{6}" inputmode="numeric" placeholder="000000" class="code-input">
        </div>
        <button class="btn btn-primary btn-lg btn-full" onclick="setupPairDevice()">
            <span class="btn-text">Connect Device</span>
            <span class="btn-loader" style="display:none;"></span>
        </button>
        <div id="setup-device-error" class="msg-error" style="display:none;"></div>
        <div id="setup-device-success" class="msg-success" style="display:none;"></div>
        <button class="btn-skip" onclick="showScreen('setup-students-screen')">Skip for Now</button>
    </div>
</div>

<!-- ============================================================ -->
<!-- SETUP: STEP 2 - ADD STUDENTS -->
<!-- ============================================================ -->
<div id="setup-students-screen" class="screen">
    <div class="setup-container">
        <div class="progress-steps">
            <div class="step done">&#10003;</div>
            <div class="step-line active"></div>
            <div class="step active">2</div>
            <div class="step-line"></div>
            <div class="step">3</div>
            <div class="step-line"></div>
            <div class="step">4</div>
        </div>
        <h1>Tell Us About Your Children</h1>
        <p class="setup-sub">You can add up to 2 students</p>
        <div class="student-form-card">
            <h3>Student 1</h3>
            <div class="input-group">
                <input type="text" id="setup-s1-name" placeholder="Child's name" required>
            </div>
            <div class="form-row-2">
                <select id="setup-s1-class" required>
                    <option value="">Class</option>
                    <option value="Class 2">Class 2</option>
                    <option value="Class 3">Class 3</option>
                    <option value="Class 4">Class 4</option>
                    <option value="Class 5">Class 5</option>
                    <option value="Class 6">Class 6</option>
                    <option value="Class 7">Class 7</option>
                </select>
                <select id="setup-s1-board">
                    <option value="CBSE">CBSE</option>
                    <option value="ICSE">ICSE</option>
                    <option value="State Board">State Board</option>
                </select>
            </div>
        </div>
        <div id="setup-s2-section" class="student-form-card" style="display:none;">
            <h3>Student 2</h3>
            <div class="input-group">
                <input type="text" id="setup-s2-name" placeholder="Child's name">
            </div>
            <div class="form-row-2">
                <select id="setup-s2-class">
                    <option value="">Class</option>
                    <option value="Class 2">Class 2</option>
                    <option value="Class 3">Class 3</option>
                    <option value="Class 4">Class 4</option>
                    <option value="Class 5">Class 5</option>
                    <option value="Class 6">Class 6</option>
                    <option value="Class 7">Class 7</option>
                </select>
                <select id="setup-s2-board">
                    <option value="CBSE">CBSE</option>
                    <option value="ICSE">ICSE</option>
                    <option value="State Board">State Board</option>
                </select>
            </div>
            <button class="btn-remove" onclick="hideSecondStudent()">Remove</button>
        </div>
        <button id="add-s2-btn" class="btn btn-outline btn-full" onclick="showSecondStudent()" style="margin-bottom:16px;">+ Add Second Student</button>
        <div id="setup-students-error" class="msg-error" style="display:none;"></div>
        <button class="btn btn-primary btn-lg btn-full" onclick="setupAddStudents()">
            <span class="btn-text">Continue</span>
            <span class="btn-loader" style="display:none;"></span>
        </button>
    </div>
</div>

<!-- ============================================================ -->
<!-- SETUP: STEP 3 - UPLOAD TEXTBOOKS -->
<!-- ============================================================ -->
<div id="setup-textbooks-screen" class="screen">
    <div class="setup-container">
        <div class="progress-steps">
            <div class="step done">&#10003;</div>
            <div class="step-line done"></div>
            <div class="step done">&#10003;</div>
            <div class="step-line active"></div>
            <div class="step active">3</div>
            <div class="step-line"></div>
            <div class="step">4</div>
        </div>
        <h1>Upload Textbooks</h1>
        <p class="setup-sub">Upload your child's textbooks so Guru can help with studies</p>
        <div class="subject-upload-grid">
            <div class="subject-upload-card" data-subject="Mathematics">
                <span class="subject-emoji">&#128208;</span>
                <span class="subject-name">Maths</span>
                <input type="file" accept=".pdf" class="subject-file-input" style="display:none;">
                <button class="btn btn-small btn-outline upload-btn" onclick="triggerSubjectUpload(this)">Upload</button>
                <span class="upload-status"></span>
            </div>
            <div class="subject-upload-card" data-subject="Science">
                <span class="subject-emoji">&#128300;</span>
                <span class="subject-name">Science</span>
                <input type="file" accept=".pdf" class="subject-file-input" style="display:none;">
                <button class="btn btn-small btn-outline upload-btn" onclick="triggerSubjectUpload(this)">Upload</button>
                <span class="upload-status"></span>
            </div>
            <div class="subject-upload-card" data-subject="English">
                <span class="subject-emoji">&#128214;</span>
                <span class="subject-name">English</span>
                <input type="file" accept=".pdf" class="subject-file-input" style="display:none;">
                <button class="btn btn-small btn-outline upload-btn" onclick="triggerSubjectUpload(this)">Upload</button>
                <span class="upload-status"></span>
            </div>
            <div class="subject-upload-card" data-subject="Hindi">
                <span class="subject-emoji">&#127470;&#127475;</span>
                <span class="subject-name">Hindi</span>
                <input type="file" accept=".pdf" class="subject-file-input" style="display:none;">
                <button class="btn btn-small btn-outline upload-btn" onclick="triggerSubjectUpload(this)">Upload</button>
                <span class="upload-status"></span>
            </div>
            <div class="subject-upload-card" data-subject="Social Studies">
                <span class="subject-emoji">&#127758;</span>
                <span class="subject-name">Social</span>
                <input type="file" accept=".pdf" class="subject-file-input" style="display:none;">
                <button class="btn btn-small btn-outline upload-btn" onclick="triggerSubjectUpload(this)">Upload</button>
                <span class="upload-status"></span>
            </div>
            <div class="subject-upload-card" data-subject="EVS">
                <span class="subject-emoji">&#127793;</span>
                <span class="subject-name">EVS</span>
                <input type="file" accept=".pdf" class="subject-file-input" style="display:none;">
                <button class="btn btn-small btn-outline upload-btn" onclick="triggerSubjectUpload(this)">Upload</button>
                <span class="upload-status"></span>
            </div>
        </div>
        <div id="setup-upload-progress" class="msg-info" style="display:none;"></div>
        <button class="btn btn-primary btn-lg btn-full" onclick="showScreen('setup-done-screen')">Continue</button>
        <button class="btn-skip" onclick="showScreen('setup-done-screen')">I'll upload later</button>
    </div>
</div>

<!-- ============================================================ -->
<!-- SETUP: STEP 4 - DONE -->
<!-- ============================================================ -->
<div id="setup-done-screen" class="screen">
    <div class="setup-container setup-done-center">
        <div class="progress-steps">
            <div class="step done">&#10003;</div>
            <div class="step-line done"></div>
            <div class="step done">&#10003;</div>
            <div class="step-line done"></div>
            <div class="step done">&#10003;</div>
            <div class="step-line done"></div>
            <div class="step done">&#10003;</div>
        </div>
        <div class="done-animation">
            <div class="done-circle">&#10003;</div>
        </div>
        <h1>All Set!</h1>
        <p class="setup-sub" id="setup-done-msg">Your Guru is ready to help your child learn</p>
        <div class="done-summary">
            <div class="done-item"><span class="done-check">&#10003;</span> Account Created</div>
            <div class="done-item" id="done-device"><span class="done-check">&#10003;</span> Device Connected</div>
            <div class="done-item" id="done-students"><span class="done-check">&#10003;</span> Students Added</div>
            <div class="done-item" id="done-textbooks"><span class="done-check">&#10003;</span> Textbooks Uploaded</div>
        </div>
        <button class="btn btn-primary btn-lg btn-full" onclick="finishSetup()">Get Started</button>
    </div>
</div>

<!-- ============================================================ -->
<!-- MAIN APP SHELL -->
<!-- ============================================================ -->
<div id="app-shell" class="screen">
    <nav class="top-nav">
        <div class="nav-left">
            <div class="nav-logo">G</div>
            <span class="nav-title">Guru.ai</span>
        </div>
        <div class="nav-center">
            <div class="student-switcher" id="student-switcher" onclick="toggleStudentDropdown()">
                <span id="current-student-name">Student</span>
                <span class="switcher-arrow">&#9660;</span>
            </div>
            <div id="student-dropdown" class="student-dropdown" style="display:none;"></div>
        </div>
        <div class="nav-right">
            <div class="nav-profile" onclick="toggleProfileMenu()">
                <span id="nav-parent-initial" class="profile-initial">P</span>
            </div>
            <div id="profile-menu" class="profile-menu" style="display:none;">
                <div class="profile-header">
                    <span id="profile-name">Parent</span>
                    <span id="profile-email">email</span>
                </div>
                <button onclick="logout()">Logout</button>
            </div>
        </div>
    </nav>

    <main class="main-content" id="main-content">
        <!-- HOME TAB -->
        <div id="tab-home" class="tab-content active">
            <!-- TOP STATS ROW (5 cards) -->
            <div class="stats-row-5">
                <div class="stat-card stat-fire">
                    <div class="stat-icon">&#128293;</div>
                    <div class="stat-value" id="stat-streak">0 days</div>
                    <div class="stat-label">Streak</div>
                </div>
                <div class="stat-card stat-blue">
                    <div class="stat-icon">&#9201;</div>
                    <div class="stat-value" id="stat-avg-time">0 min</div>
                    <div class="stat-label">Avg Time</div>
                </div>
                <div class="stat-card stat-green">
                    <div class="stat-icon">&#127919;</div>
                    <div class="stat-value" id="stat-accuracy">-</div>
                    <div class="stat-label">Accuracy</div>
                </div>
                <div class="stat-card stat-purple">
                    <div class="stat-icon">&#128202;</div>
                    <div class="stat-value" id="stat-exam-readiness">-</div>
                    <div class="stat-label">Exam Ready</div>
                </div>
                <div class="stat-card stat-hw hw-none" id="stat-hw-card">
                    <div class="stat-icon">&#128221;</div>
                    <div class="stat-value" id="stat-hw-status">-</div>
                    <div class="stat-label">Homework</div>
                    <div class="stat-detail" id="stat-hw-detail"></div>
                </div>
            </div>

            <!-- Overall Progress Trend (Line Chart) -->
            <div class="chart-card">
                <h3>Overall Progress</h3>
                <p class="chart-sub" id="chart-sub-name">Accuracy trend over the last 7 days</p>
                <div class="chart-wrap"><canvas id="progressChart"></canvas></div>
            </div>

            <!-- Subject Performance (Horizontal Bar Chart) -->
            <div class="chart-card">
                <h3>Subject Performance</h3>
                <p class="chart-sub">Accuracy by subject</p>
                <div class="chart-wrap"><canvas id="subjectChart"></canvas></div>
            </div>

            <!-- Weakest Topics (Focus Areas) -->
            <div class="section-card">
                <h3>Focus Areas</h3>
                <p class="chart-sub">Topics that need more practice</p>
                <div id="weakest-topics" class="topics-list">
                    <div class="empty-state" style="padding:20px 8px;">
                        <p style="color:#888;font-size:14px;">No focus areas identified yet.</p>
                    </div>
                </div>
            </div>

            <!-- Study Consistency (28-day Heatmap) -->
            <div class="section-card">
                <h3>Study Consistency</h3>
                <p class="chart-sub">Last 28 days activity</p>
                <div id="study-heatmap" class="heatmap-container"></div>
            </div>

            <!-- Exam Readiness Gauge -->
            <div class="chart-card">
                <h3>Exam Readiness</h3>
                <p class="chart-sub">Based on accuracy, consistency &amp; subject coverage</p>
                <div id="exam-readiness-gauge" class="gauge-container"></div>
            </div>

            <!-- Recent Sessions -->
            <div class="section-card">
                <h3>Recent Sessions</h3>
                <div id="recent-sessions" class="list-container">
                    <div class="empty-state">
                        <div class="empty-icon">&#128218;</div>
                        <p>No study sessions yet</p>
                        <p class="empty-sub">Sessions appear after your child uses Guru</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions-grid">
                <button class="quick-action" onclick="switchTab('homework')">
                    <span class="qa-icon">&#128221;</span><span>Assign Homework</span>
                </button>
                <button class="quick-action" onclick="switchTab('textbooks')">
                    <span class="qa-icon">&#128218;</span><span>Upload Textbook</span>
                </button>
                <button class="quick-action" onclick="showScreen('setup-device-screen')">
                    <span class="qa-icon">&#128241;</span><span>Pair Device</span>
                </button>
            </div>
        </div>

        <!-- HOMEWORK TAB -->
        <div id="tab-homework" class="tab-content">
            <div class="section-card">
                <h3>Assign New Homework</h3>
                <form id="hw-form">
                    <div class="form-row-2">
                        <div class="input-group"><label>Student</label><select id="hw-student" required></select></div>
                        <div class="input-group"><label>Subject</label>
                            <select id="hw-subject" required>
                                <option value="">Select</option>
                                <option value="Mathematics">Mathematics</option>
                                <option value="Science">Science</option>
                                <option value="English">English</option>
                                <option value="Hindi">Hindi</option>
                                <option value="Social Studies">Social Studies</option>
                                <option value="General">General</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group"><label>Homework Description</label>
                        <textarea id="hw-text" rows="3" placeholder="e.g. Complete page 45, questions 1-5" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <span class="btn-text">Assign Homework</span><span class="btn-loader" style="display:none;"></span>
                    </button>
                    <div id="hw-error" class="msg-error" style="display:none;"></div>
                    <div id="hw-success" class="msg-success" style="display:none;"></div>
                </form>
            </div>
            <div class="section-card"><h3>Recent Homework</h3><div id="hw-list" class="list-container"><div class="skeleton-loader"></div></div></div>
        </div>

        <!-- TEXTBOOKS TAB -->
        <div id="tab-textbooks" class="tab-content">
            <div class="section-card">
                <h3>Upload Textbook</h3>
                <form id="tb-form">
                    <div class="form-row-2">
                        <div class="input-group"><label>Book Name</label><input type="text" id="tb-name" placeholder="e.g. NCERT Maths" required></div>
                        <div class="input-group"><label>Subject</label>
                            <select id="tb-subject" required>
                                <option value="">Select</option>
                                <option value="Mathematics">Mathematics</option>
                                <option value="Science">Science</option>
                                <option value="English">English</option>
                                <option value="Hindi">Hindi</option>
                                <option value="Social Studies">Social Studies</option>
                                <option value="EVS">EVS</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group"><label>Class Level</label>
                        <select id="tb-class" required>
                            <option value="">Select</option>
                            <option value="Class 2">Class 2</option><option value="Class 3">Class 3</option>
                            <option value="Class 4">Class 4</option><option value="Class 5">Class 5</option>
                            <option value="Class 6">Class 6</option><option value="Class 7">Class 7</option>
                        </select>
                    </div>
                    <div class="input-group"><label>PDF File (max 50MB)</label><input type="file" id="tb-file" accept=".pdf" required></div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <span class="btn-text">Upload Textbook</span><span class="btn-loader" style="display:none;"></span>
                    </button>
                    <div id="tb-upload-progress" class="progress-bar" style="display:none;"><div class="progress-fill"></div></div>
                    <div id="tb-error" class="msg-error" style="display:none;"></div>
                    <div id="tb-success" class="msg-success" style="display:none;"></div>
                </form>
            </div>
            <div class="section-card"><h3>My Textbooks</h3><div id="tb-list" class="list-container"><div class="skeleton-loader"></div></div></div>
        </div>

        <!-- SUMMARIES TAB -->
        <div id="tab-summaries" class="tab-content">
            <div class="filters-bar">
                <select id="sum-student-filter"><option value="">All Students</option></select>
                <button class="btn btn-small btn-outline" onclick="loadSummaries()">Refresh</button>
            </div>
            <div id="sum-list" class="list-container"><div class="skeleton-loader"></div></div>
        </div>
    </main>

    <nav class="bottom-nav">
        <button class="nav-tab active" data-tab="home" onclick="switchTab('home')">
            <span class="tab-icon">&#127968;</span><span class="tab-label">Home</span>
        </button>
        <button class="nav-tab" data-tab="homework" onclick="switchTab('homework')">
            <span class="tab-icon">&#9999;&#65039;</span><span class="tab-label">Homework</span>
        </button>
        <button class="nav-tab" data-tab="textbooks" onclick="switchTab('textbooks')">
            <span class="tab-icon">&#128218;</span><span class="tab-label">Books</span>
        </button>
        <button class="nav-tab" data-tab="summaries" onclick="switchTab('summaries')">
            <span class="tab-icon">&#128202;</span><span class="tab-label">Sessions</span>
        </button>
    </nav>
</div>

<script src="api.js"></script>
<script src="auth.js"></script>
<script src="analytics.js"></script>
<script src="app.js"></script>
</body>
</html>
